{
  "steps": [
    {
      "id": "open_bilibili",
      "action": "open",
      "target": "https://www.bilibili.com"
    },
    {
      "id": "wait_home",
      "action": "wait",
      "target": "networkidle",
      "guards": [
        {
          "kind": "url_contains",
          "value": "bilibili.com"
        }
      ]
    },
    {
      "id": "click_hot",
      "action": "click_text",
      "value": "热门",
      "optional": true,
      "params": {
        "exact": false
      }
    },
    {
      "id": "click_weekly",
      "action": "click_text",
      "value": "每周必看",
      "optional": true,
      "params": {
        "exact": false
      }
    },
    {
      "id": "open_weekly_direct",
      "action": "open",
      "target": "https://www.bilibili.com/v/popular/weekly"
    },
    {
      "id": "wait_weekly",
      "action": "wait",
      "target": "networkidle"
    },
    {
      "id": "extract_top10",
      "action": "eval_js",
      "params": {
        "save_as": "weekly_top10",
        "script": "const num = new URL(location.href).searchParams.get('num') || '361'; const api = `https://api.bilibili.com/x/web-interface/popular/series/one?number=${num}`; return fetch(api, { credentials: 'include' }).then((resp) => resp.json()).then((json) => { const list = json?.data?.list || []; const items = list.slice(0, 10).map((x) => ({ title: x?.title || '', url: x?.bvid ? `https://www.bilibili.com/video/${x.bvid}` : '' })).filter((x) => x.title && x.url); return { page_url: location.href, api, count: items.length, items }; });"
      }
    },
    {
      "id": "write_md",
      "action": "write_markdown",
      "params": {
        "path": "./artifacts/bilibili_weekly_top10.md",
        "title": "Bilibili 每周必看 Top10",
        "items_var": "weekly_top10.items"
      }
    },
    {
      "id": "assert_md",
      "action": "assert_markdown",
      "params": {
        "path": "./artifacts/bilibili_weekly_top10.md",
        "min_links": 10,
        "must_include": [
          "Bilibili 每周必看 Top10"
        ]
      }
    }
  ]
}
